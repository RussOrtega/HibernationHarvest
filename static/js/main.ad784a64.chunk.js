(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{145:function(e,t,n){"use strict";(function(e){var a=n(82),r=n(4),s=n.n(r),i=n(5),c=n(53),o=n(54),u=n(57),l=n(56),h=(n(162),n(163),n(0)),d=n.n(h),f=n(15),p=n.n(f),b=n(35),x=n(37),g=n(150),m=n.n(g),v=n(151),j=n(2),w=new p.a("10000000000000000000000"),_={networkId:"testnet",nodeUrl:"https://rpc.testnet.near.org",contractName:"hibernationharvest.testnet",walletUrl:"https://wallet.testnet.near.org"},k=Object(j.jsx)("span",{role:"img","aria-label":"chipmunk",className:"berry",children:"\ud83d\udc3f\ufe0f"}),y=Object(j.jsx)("span",{role:"img","aria-label":"acorn",className:"berry",children:"\ud83c\udf30"}),O=Object(j.jsx)("span",{role:"img","aria-label":"seedling",className:"berry",children:"\ud83c\udf31"}),C="Chipmunk",I="Acorn",N=50,P=50,S=12,A=12,B=6e5,F=function(e){return"#".concat(e.toString(16).padStart(6,"0"))},T=function(e,t){return"#".concat(e.toString(16).padStart(6,"0")).concat(Math.round(255*t).toString(16).padStart(2,"0"))},M=function(e,t,n,a,r){var s=255&r,i=r>>8&255,c=r>>16&255;return(Math.round(e*a+c*(1-a))<<16)+(Math.round(t*a+i*(1-a))<<8)+Math.round(n*a+s*(1-a))},R=function(e,t){return M(255&e,e>>8&255,e>>16&255,(e>>24&255)/255,t)},D=function(e){e=F(e).substr(1);var t=parseInt(e.substr(0,2),16)/255,n=parseInt(e.substr(2,2),16)/255,a=parseInt(e.substr(4,2),16)/255,r=Math.max(t,n,a),s=r-Math.min(t,n,a),i=s&&(r===t?(n-a)/s:r===n?2+(a-t)/s:4+(t-n)/s);return[60*(i<0?i+6:i),r&&s/r,r]},E=function(e,t){return"rgba(".concat((e>>16)/1,", ").concat((e>>8&255)/1,", ").concat((255&e)/1,", ").concat(t,")")},L=function(e){for(var t=[],n=0;n<31;++n)t.push("hsl(".concat(e,", 100%, ").concat(100*n/30,"%)"));return t},H=function(t){var n=e.from(t,"base64");if(404!==n.length)throw new Error("Unexpected encoded line length");for(var a=[],r=4;r<n.length;r+=8){var s=n.readUInt32LE(r),i=n.readUInt32LE(r+4);a.push({color:s,ownerIndex:i})}return a},q="idkfa",Q=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;Object(c.a)(this,n),a=t.call(this,e);var r=["#000000","#666666","#aaaaaa","#FFFFFF","#F44E3B","#D33115","#9F0500","#FE9200","#E27300","#C45100","#FCDC00","#FCC400","#FB9E00","#DBDF00","#B0BC00","#808900","#A4DD00","#68BC00","#194D33","#68CCCA","#16A5A5","#0C797D","#73D8FF","#009CE0","#0062B1","#AEA1FF","#7B64FF","#653294","#FDA1FF","#FA28FF","#AB149E"].map((function(e){return e.toLowerCase()})),s=parseInt(r[0].substring(1),16);return a.state={connected:!1,signedIn:!1,accountId:null,pendingPixels:0,boardLoaded:!1,selectedCell:null,alpha:.25,currentColor:s,pickerColor:T(s,.25),colors:r,gammaColors:L(0),pickingColor:!1,owners:[],accounts:{},highlightedAccountIndex:-1,selectedOwnerIndex:!1,farmingAcorn:!1,weaponsOn:!1,weaponsCodePosition:0},a._buttonDown=!1,a._oldCounts={},a._numFailedTxs=0,a._balanceRefreshTimer=null,a.canvasRef=d.a.createRef(),a._context=!1,a._lines=!1,a._queue=[],a._pendingPixels=[],a._refreshBoardTimer=null,a._sendQueueTimer=null,a._stopRefreshTime=(new Date).getTime()+B,a._accounts={},a._initNear().then((function(){a.setState({connected:!0,signedIn:!!a._accountId,accountId:a._accountId,ircAccountId:a._accountId.replace(".","_")})})),a}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.canvasRef.current;this._context=t.getContext("2d");var n=function(){var t=Object(i.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.state.rendering){t.next=5;break}return t.next=3,e.drawImg(e.state.selectedCell);case 3:t.next=12;break;case 5:if(!e.state.pickingColor){t.next=9;break}e.pickColor(e.state.selectedCell),t.next=12;break;case 9:return e.saveColor(),t.next=12,e.drawPixel(e.state.selectedCell);case 12:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),a=function(t){var a,r;if("touches"in t){if(t.touches.length>1)return!0;var c=t.target.getBoundingClientRect();a=t.targetTouches[0].clientX-c.left,r=t.targetTouches[0].clientY-c.top}else a=t.offsetX,r=t.offsetY;a=Math.trunc(a/t.target.clientWidth*P),r=Math.trunc(r/t.target.clientHeight*P);var o=null;return a>=0&&a<P&&r>=0&&r<N&&(o={x:a,y:r}),JSON.stringify(o)!==JSON.stringify(e.state.selectedCell)&&e.setState({selectedCell:o,selectedOwnerIndex:e._lines&&o&&e._lines[o.y]&&e._lines[o.y][o.x].ownerIndex},Object(i.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.renderCanvas(),null===e.state.selectedCell||!e._buttonDown){t.next=4;break}return t.next=4,n();case 4:case"end":return t.stop()}}),t)})))),t.preventDefault(),!1};t.addEventListener("mousemove",a),t.addEventListener("touchmove",a);var r=function(){var t=Object(i.a)(s.a.mark((function t(a){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e._buttonDown=!0,null===e.state.selectedCell){t.next=4;break}return t.next=4,n();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();t.addEventListener("mousedown",r),t.addEventListener("touchstart",r);var c=function(){e.setState({selectedCell:null},(function(){return e.renderCanvas()}))},o=function(){var t=Object(i.a)(s.a.mark((function t(n){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e._buttonDown=!1,"touches"in n&&c();case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();t.addEventListener("mouseup",o),t.addEventListener("touchend",o),t.addEventListener("mouseleave",c),t.addEventListener("mouseenter",(function(t){e._buttonDown&&("touches"in t||1&t.buttons||(e._buttonDown=!1))})),document.addEventListener("keydown",(function(t){t.altKey&&e.enablePickColor()})),document.addEventListener("keyup",(function(t){e.state.weaponsCodePosition<q.length&&(t.key.toLowerCase()===q[e.state.weaponsCodePosition]?e.setState({weaponsCodePosition:e.state.weaponsCodePosition+1,weaponsOn:e.state.weaponsCodePosition+1===q.length}):e.setState({weaponsCodePosition:0})),!t.altKey&&e.disablePickColor()}))}},{key:"enablePickColor",value:function(){var e=this;this.setState({pickingColor:!0},(function(){e.renderCanvas()}))}},{key:"disablePickColor",value:function(){var e=this;this.setState({pickingColor:!1},(function(){e.renderCanvas()}))}},{key:"pickColor",value:function(e){var t=this;if(this.state.signedIn&&this._lines&&this._lines[e.y]){var n=this._lines[e.y][e.x].color;this.setState({currentColor:n,alpha:1,pickerColor:T(n,1),gammaColors:L(D(n)[0]),pickingColor:!1},(function(){t.renderCanvas()}))}}},{key:"_sendQueue",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._queue.slice(0,100),this._queue=this._queue.slice(100),this._pendingPixels=t,e.prev=3,e.next=6,this._contract.draw({pixels:t},new p.a("75000000000000"));case 6:this._numFailedTxs=0,e.next=14;break;case 9:e.prev=9,e.t0=e.catch(3),console.log("Failed to send a transaction",e.t0),this._numFailedTxs+=1,this._numFailedTxs<3?(this._queue=this._queue.concat(this._pendingPixels),this._pendingPixels=[]):(this._pendingPixels=[],this._queue=[]);case 14:return e.prev=14,e.next=17,Promise.all([this.refreshBoard(!0),this.refreshAccountStats()]);case 17:e.next=21;break;case 19:e.prev=19,e.t1=e.catch(14);case 21:this._pendingPixels.forEach((function(e){n._pending[e.y][e.x]===e.color&&(n._pending[e.y][e.x]=-1)})),this._pendingPixels=[];case 23:case"end":return e.stop()}}),e,this,[[3,9],[14,19]])})));return function(){return e.apply(this,arguments)}}()},{key:"_pingQueue",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._sendQueueTimer&&(clearTimeout(this._sendQueueTimer),this._sendQueueTimer=null),0!==this._pendingPixels.length||!(this._queue.length>=100||t)){e.next=4;break}return e.next=4,this._sendQueue();case 4:this._queue.length>0&&(this._sendQueueTimer=setTimeout(Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._pingQueue(!0);case 2:case"end":return e.stop()}}),e)}))),500));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"drawImg",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,a,r,i,c,o,u,l,h,d,f;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.signedIn&&this._lines&&this._lines[t.y]){e.next=2;break}return e.abrupt("return");case 2:if(!((this.state.account?this.state.account.chipmunkBalance:0)-this.state.pendingPixels<this.state.chipmunkNeeded)){e.next=5;break}return e.abrupt("return");case 5:for(n=this.imageData,a=n.width,r=n.height,i=t.x-Math.trunc(a/2),c=t.y-Math.trunc(r/2),o=new Uint32Array(this.imageData.data.buffer),u=0;u<r;++u)for(l=0;l<a;++l)(h=o[u*a+l])&&c+u>=0&&c+u<N&&i+l>=0&&i+l<P&&(d=this._lines[c+u]?this._lines[c+u][i+l].color:0,(f=R(h,d))!==d&&this._queue.push({x:i+l,y:c+u,color:f}));return this.setState({rendering:!1}),this._stopRefreshTime=(new Date).getTime()+B,e.next=16,this._pingQueue(!1);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"drawPixel",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,a,r,i,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.signedIn&&this._lines&&this._lines[t.y]){e.next=2;break}return e.abrupt("return");case 2:if(!((this.state.account?this.state.account.chipmunkBalance:0)-this.state.pendingPixels<1)){e.next=5;break}return e.abrupt("return");case 5:if(n=this._lines[t.y]?this._lines[t.y][t.x].color:0,a=255&this.state.currentColor,r=this.state.currentColor>>8&255,i=this.state.currentColor>>16&255,c=M(i,r,a,this.state.alpha,n),this._pending[t.y][t.x]===c||this._lines[t.y][t.x].color===c){e.next=14;break}this._pending[t.y][t.x]=c,e.next=15;break;case 14:return e.abrupt("return");case 15:return this._queue.push({x:t.x,y:t.y,color:c}),this._stopRefreshTime=(new Date).getTime()+B,e.next=19,this._pingQueue(!1);case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"parseAccount",value:function(e,t){return(e=e?{accountId:e.account_id,accountIndex:e.account_index,chipmunkBalance:parseFloat(e.chipmunk_balance)/this._pixelCost,acornBalance:parseFloat(e.acorn_balance)/this._pixelCost,numPixels:e.num_pixels,farmingPreference:e.farming_preference}:{accountId:t,accountIndex:-1,chipmunkBalance:25,acornBalance:0,numPixels:0,farmingPreference:C}).startTime=(new Date).getTime(),e.chipmunkPixels=e.farmingPreference===C?e.numPixels+1:0,e.acornPixels=e.farmingPreference===I?e.numPixels:0,e.chipmunkRewardPerMs=e.chipmunkPixels/864e5,e.acornRewardPerMs=e.acornPixels/864e5,e}},{key:"getAccount",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this._contract.get_account({account_id:t});case 3:return e.t1=e.sent,e.t2=t,e.abrupt("return",e.t0.parseAccount.call(e.t0,e.t1,e.t2));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAccountByIndex",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this._contract.get_account_by_index({account_index:t});case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parseAccount.call(e.t0,e.t1,"unknown"));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"refreshAccountStats",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAccount(this._accountId);case 2:t=e.sent,this._balanceRefreshTimer&&(clearInterval(this._balanceRefreshTimer),this._balanceRefreshTimer=null),this.setState({pendingPixels:this._pendingPixels.length+this._queue.length,farmingAcorn:t.farmingPreference===I,account:t}),this._balanceRefreshTimer=setInterval((function(){var e=(new Date).getTime()-t.startTime;n.setState({account:Object.assign({},t,{chipmunkBalance:t.chipmunkBalance+e*t.chipmunkRewardPerMs,acornBalance:t.acornBalance+e*t.acornRewardPerMs}),pendingPixels:n._pendingPixels.length+n._queue.length})}),100);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initNear",value:function(){var e=Object(i.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new b.keyStores.BrowserLocalStorageKeyStore,e.next=3,b.connect(Object.assign({deps:{keyStore:t}},_));case 3:return n=e.sent,this._keyStore=t,this._near=n,this._walletConnection=new b.WalletConnection(n,_.contractName),this._accountId=this._walletConnection.getAccountId(),this._account=this._walletConnection.account(),this._contract=new b.Contract(this._account,_.contractName,{viewMethods:["get_account","get_account_by_index","get_lines","get_line_versions","get_pixel_cost","get_account_balance","get_account_num_pixels","get_account_id_by_index"],changeMethods:["draw","buy_tokens","select_farming_preference"]}),e.t0=parseFloat,e.next=13,this._contract.get_pixel_cost();case 13:if(e.t1=e.sent,this._pixelCost=(0,e.t0)(e.t1),!this._accountId){e.next=18;break}return e.next=18,this.refreshAccountStats();case 18:return this._lineVersions=Array(N).fill(-1),this._lines=Array(N).fill(!1),this._pending=Array(N).fill(!1),this._pending.forEach((function(e,t,n){return n[t]=Array(P).fill(-1)})),e.next=24,this.refreshBoard(!0);case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshBoard",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,a,r,c,o,u,l,h,d,f=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._refreshBoardTimer&&(clearTimeout(this._refreshBoardTimer),this._refreshBoardTimer=null),(new Date).getTime()<this._stopRefreshTime&&(this._refreshBoardTimer=setTimeout(Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.refreshBoard(!1);case 2:case"end":return e.stop()}}),e)}))),1e3)),t||!document.hidden){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,this._contract.get_line_versions();case 7:for(n=e.sent,a=[],r=0;r<N;++r)n[r]!==this._lineVersions[r]&&a.push(r);for(c=[],o=0;o<a.length;o+=10)c.push(a.slice(o,o+10));return e.next=14,Promise.all(c.map((function(e){return f._contract.get_lines({lines:e})})));case 14:for(u=(u=e.sent).flat(),c=c.flat(),l=0;l<c.length;++l)h=c[l],d=H(u[l]),this._lines[h]=d;this._lineVersions=n,this._refreshOwners(),this.renderCanvas();case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_refreshOwners",value:function(){var e=this,t={};this._lines.flat().forEach((function(e){t[e.ownerIndex]=(t[e.ownerIndex]||0)+1})),delete t[0];var n=Object.keys(t).sort((function(e,n){return t[n]-t[e]}));this.setState({owners:n.map((function(e){return{accountIndex:e=parseInt(e),numPixels:t[e]}}))}),n.forEach(function(){var n=Object(i.a)(s.a.mark((function n(a){return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((a=parseInt(a))in e._accounts&&t[a]===(e._oldCounts[a]||0)){n.next=12;break}return n.prev=2,n.next=5,e.getAccountByIndex(a);case 5:e._accounts[a]=n.sent,n.next=11;break;case 8:n.prev=8,n.t0=n.catch(2),console.log("Failed to fetch account index #",a,n.t0);case 11:e.setState({accounts:Object.assign({},e._accounts)});case 12:case"end":return n.stop()}}),n,null,[[2,8]])})));return function(e){return n.apply(this,arguments)}}()),this.setState({accounts:Object.assign({},this._accounts)}),this._oldCounts=t}},{key:"renderCanvas",value:function(){if(this._context&&this._lines){for(var e=this._context,t=0;t<N;++t){var n=this._lines[t];if(n)for(var a=0;a<P;++a){var r=n[a];e.fillStyle=F(r.color),e.fillRect(a*S,t*A,S,A),this.state.highlightedAccountIndex>=0&&(r.ownerIndex!==this.state.highlightedAccountIndex?(e.fillStyle="rgba(32, 32, 32, 0.8)",e.fillRect(a*S,t*A,6,6),e.fillRect((a+.5)*S,(t+.5)*A,6,6),e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(a*S,(t+.5)*A,6,6),e.fillRect((a+.5)*S,t*A,6,6)):(e.beginPath(),e.strokeStyle=e.fillStyle="rgba(255, 255, 255, 0.8)",e.lineWidth=.5,e.rect(a*S+.5,t*A+.5,11,11),e.stroke(),e.closePath()))}}if(this._pendingPixels.concat(this._queue).forEach((function(t){e.fillStyle=F(t.color),e.fillRect(t.x*S,t.y*A,S,A)})),this.state.selectedCell){var s=this.state.selectedCell;if(this.state.rendering)for(var i=this.imageData,c=i.width,o=i.height,u=s.x-Math.trunc(c/2),l=s.y-Math.trunc(o/2),h=new Uint32Array(this.imageData.data.buffer),d=0;d<o;++d)for(var f=0;f<c;++f){var p=h[d*c+f];if(p&&l+d>=0&&l+d<N&&u+f>=0&&u+f<P){var b=this._lines[l+d]?this._lines[l+d][u+f].color:0;e.fillStyle=F(R(p,b)),e.fillRect((u+f)*S,(l+d)*A,S,A)}}else if(this.state.pickingColor){var x=this._lines[s.y]?this._lines[s.y][s.x].color:0;e.beginPath(),e.strokeStyle=e.fillStyle=E(x,.5),e.lineWidth=48,e.arc((s.x+.5)*S,(s.y+.5)*A,48,0,2*Math.PI),e.stroke(),e.closePath(),e.beginPath(),e.strokeStyle=e.fillStyle=E(x,1),e.lineWidth=24,e.arc((s.x+.5)*S,(s.y+.5)*A,48,0,2*Math.PI),e.stroke(),e.closePath()}else e.fillStyle=E(this.state.currentColor,.2),e.fillRect(s.x*S,0,S,s.y*A),e.fillRect(s.x*S,(s.y+1)*A,S,(N-s.y-1)*A),e.fillRect(0,s.y*A,s.x*S,A),e.fillRect((s.x+1)*S,s.y*A,(P-s.x-1)*S,A),e.beginPath(),e.lineWidth=3,e.fillStyle=F(this.state.currentColor),e.strokeStyle=F(this.state.currentColor),e.rect(s.x*S,s.y*A,S,A),e.stroke(),e.closePath()}this.state.boardLoaded||this.setState({boardLoaded:!0})}}},{key:"requestSignIn",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"Hibernation Harvest",e.next=3,this._walletConnection.requestSignIn(_.contractName,"Hibernation Harvest");case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"logOut",value:function(){var e=Object(i.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._walletConnection.signOut(),this._accountId=null,this.setState({signedIn:!!this._accountId,accountId:this._accountId});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"alphaColorChange",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({alpha:t.rgb.a},(function(){n.changeColor(t,t.rgb.a)}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hueColorChange",value:function(e){this.setState({gammaColors:L(e.hsl.h)}),this.changeColor(e)}},{key:"saveColor",value:function(){var e=F(this.state.currentColor),t=this.state.colors.indexOf(e);t>=0&&this.state.colors.splice(t,1),this.setState({colors:[e].concat(this.state.colors).slice(0,31)})}},{key:"changeColor",value:function(e,t){var n=this;t=t||1;var a=65536*e.rgb.r+256*e.rgb.g+e.rgb.b;e.hex=T(a,t),e.rgb.a=t,e.hsl.a=t,e.hsv.a=t,this.setState({pickerColor:e,alpha:t,currentColor:a},(function(){n.renderCanvas()}))}},{key:"buyTokens",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=w.muln(t),e.next=3,this._contract.buy_tokens({},new p.a("30000000000000"),n);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setHover",value:function(e,t){var n=this;t?this.setState({highlightedAccountIndex:e},(function(){n.renderCanvas()})):this.state.highlightedAccountIndex===e&&this.setState({highlightedAccountIndex:-1},(function(){n.renderCanvas()}))}},{key:"switchBerry",value:function(){var e=Object(i.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({farmingAcorn:t}),e.next=3,this._contract.select_farming_preference({berry:t?I:C});case 3:return e.next=5,this.refreshAccountStats();case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"renderImg",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.imageData=t,this.setState({weaponsOn:!1,weaponsCodePosition:0,rendering:!0,pickingColor:!1,chipmunkNeeded:n});case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state.connected?this.state.signedIn?Object(j.jsxs)("div",{children:[Object(j.jsx)("div",{className:"float-right",children:Object(j.jsxs)("button",{className:"btn btn-outline-secondary",onClick:function(){return e.logOut()},children:["Log out (",this.state.accountId,")"]})}),Object(j.jsxs)("div",{className:"your-balance",children:["Balance: ",Object(j.jsx)(W,{account:this.state.account,pendingPixels:this.state.pendingPixels,detailed:!0}),Object(j.jsxs)("div",{children:["Farming preference:",Object(j.jsx)(m.a,{onChange:function(t){return e.switchBerry(t)},checked:this.state.farmingAcorn,className:"react-switch",height:30,width:70,offColor:"#666",onColor:"#666",uncheckedIcon:Object(j.jsx)("div",{className:"switch-berry chipmunk",children:k}),checkedIcon:Object(j.jsx)("div",{className:"switch-berry acorn",children:y})})]})]}),Object(j.jsxs)("div",{className:"buttons",children:[Object(j.jsxs)("button",{className:"btn btn-primary",onClick:function(){return e.buyTokens(10)},children:["Buy ",Object(j.jsxs)("span",{className:"font-weight-bold",children:["25",k]})," for ",Object(j.jsx)("span",{className:"font-weight-bold",children:"\u24c30.1"})]})," ",Object(j.jsxs)("button",{className:"btn btn-primary",onClick:function(){return e.buyTokens(40)},children:["Buy ",Object(j.jsxs)("span",{className:"font-weight-bold",children:["100",k]})," for ",Object(j.jsx)("span",{className:"font-weight-bold",children:"\u24c30.4"})]})," ",Object(j.jsxs)("button",{className:"btn btn-primary",onClick:function(){return e.buyTokens(100)},children:["Buy ",Object(j.jsxs)("span",{className:"font-weight-bold",children:["250",k]})," for ",Object(j.jsx)("span",{className:"font-weight-bold",children:"\u24c31"})]})," ",Object(j.jsxs)("button",{className:"btn btn-success",onClick:function(){return e.buyTokens(500)},children:["DEAL: Buy ",Object(j.jsxs)("span",{className:"font-weight-bold",children:["1500",k]})," for ",Object(j.jsx)("span",{className:"font-weight-bold",children:"\u24c35"})]})]}),Object(j.jsxs)("div",{className:"color-picker",children:[Object(j.jsx)(x.c,{color:this.state.pickerColor,width:"100%",onChange:function(t){return e.hueColorChange(t)}}),Object(j.jsx)(x.a,{color:this.state.pickerColor,width:"100%",onChange:function(t){return e.alphaColorChange(t)}}),Object(j.jsxs)("div",{className:this.state.alpha>=.75?"display-warning":"hidden",children:[Object(j.jsx)("span",{role:"img","aria-label":"warning",children:"\u26a0\ufe0f"}),"\ufe0f Please! Don't destroy art! If you just want to farm ",y,", just draw with low opacity.",Object(j.jsx)("span",{role:"img","aria-label":"pray",children:"\ud83d\ude4f"}),"\ufe0f"]}),Object(j.jsx)(x.b,{className:"circle-picker",colors:this.state.gammaColors,color:this.state.pickerColor,triangle:"hide",width:"100%",onChangeComplete:function(t){return e.changeColor(t)}}),Object(j.jsx)(x.b,{className:"circle-picker",colors:this.state.colors,color:this.state.pickerColor,triangle:"hide",width:"100%",onChangeComplete:function(t){return e.hueColorChange(t)}})]})]}):Object(j.jsx)("div",{style:{marginBottom:"10px"},children:Object(j.jsx)("button",{className:"btn btn-primary",onClick:function(){return e.requestSignIn()},children:"Log in with NEAR Wallet"})}):Object(j.jsxs)("div",{children:["Connecting... ",Object(j.jsx)("span",{className:"spinner-grow spinner-grow-sm",role:"status","aria-hidden":"true"})]}),n=this.state.weaponsOn?Object(j.jsx)("div",{children:Object(j.jsx)(v.a,{account:this.state.account,renderIt:function(t,n){return e.renderImg(t,n)}})}):"";return Object(j.jsxs)("div",{children:[Object(j.jsxs)("div",{class:"header",children:[Object(j.jsxs)("h2",{children:[y," Hibernation Harvest ",k]})," ",Object(j.jsxs)("a",{className:"btn btn-outline-none",href:"https://farm.berryclub.io",children:["Tree Farm ",O]}),Object(j.jsxs)("a",{className:"btn btn-outline-none",href:"https://app.ref.finance/",children:["Acorn Market ",y]}),t]}),Object(j.jsx)("div",{className:"container",children:Object(j.jsxs)("div",{className:"row",children:[Object(j.jsx)("div",{children:Object(j.jsx)("div",{children:Object(j.jsx)("canvas",{ref:this.canvasRef,width:600,height:600,className:this.state.boardLoaded?"pixel-board":"pixel-board c-animated-background"})})}),Object(j.jsx)("div",{className:"leaderboard",children:Object(j.jsx)("div",{children:Object(j.jsx)(U,{owners:this.state.owners,accounts:this.state.accounts,setHover:function(t,n){return e.setHover(t,n)},selectedOwnerIndex:this.state.selectedOwnerIndex,highlightedAccountIndex:this.state.highlightedAccountIndex})})})]})}),Object(j.jsx)("div",{className:"padded",children:this.state.signedIn?Object(j.jsx)("div",{children:Object(j.jsx)("iframe",{title:"irc",className:"irc",frameBorder:"0",src:"https://kiwiirc.com/client/irc.kiwiirc.com/?nick=".concat(this.state.ircAccountId,"#HibernationHarvest")})}):""}),n]})}}]),n}(d.a.Component),W=function(e){var t=e.account;if(!t)return"";var n=e.detailed?3:1,a=t.chipmunkBalance-(e.pendingPixels||0),r=t.chipmunkPixels>0?Object(j.jsxs)("span",{children:["(+",Object(j.jsx)("span",{className:"font-weight-bold",children:t.chipmunkPixels}),k,"/day)"]}):"",s=t.acornPixels>0?Object(j.jsxs)("span",{children:["(+",Object(j.jsx)("span",{className:"font-weight-bold",children:t.acornPixels}),y,"/day)"]}):"";return Object(j.jsxs)("span",{className:"balances font-small",children:[Object(j.jsx)("span",{className:"font-weight-bold",children:a.toFixed(n)}),k," ",Object(j.jsx)("span",{className:"font-weight-bold",children:t.acornBalance.toFixed(n)}),y," ",r,s,e.pendingPixels?Object(j.jsxs)("span",{children:[" (",e.pendingPixels," pending)"]}):""]})},U=function(e){var t=e.owners.map((function(t){return t.accountIndex in e.accounts&&(t.account=e.accounts[t.accountIndex]),Object(j.jsx)(V,Object(a.a)(Object(a.a)({},t),{},{isSelected:t.accountIndex===e.selectedOwnerIndex,setHover:function(n){return e.setHover(t.accountIndex,n)},isHighlighted:t.accountIndex===e.highlightedAccountIndex}),t.accountIndex)}));return Object(j.jsx)("table",{className:"table table-hover table-sm",children:Object(j.jsx)("tbody",{children:t})})},V=function(e){var t=e.account;return Object(j.jsxs)("tr",{onMouseEnter:function(){return e.setHover(!0)},onMouseLeave:function(){return e.setHover(!1)},className:e.isSelected?"selected":"",children:[Object(j.jsx)("td",{children:t?Object(j.jsx)(J,{accountId:t.accountId}):"..."}),Object(j.jsx)("td",{className:"text-nowrap",children:Object(j.jsx)("small",{children:Object(j.jsx)(W,{account:t})})})]})},J=function(e){var t=e.accountId,n=t.length>15?t.slice(0,6)+"..."+t.slice(-6):t;return Object(j.jsx)("a",{className:"account",href:"https://wayback.berryclub.io/".concat(t),children:n})};t.a=Q}).call(this,n(11).Buffer)},151:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var a=n(52),r=n(4),s=n.n(r),i=n(5),c=n(53),o=n(54),u=n(57),l=n(56),h=(n(334),n(0)),d=n.n(h),f=n(152),p=n.n(f),b=n(2),x=Object(b.jsx)("span",{role:"img","aria-label":"seedling",className:"berry",children:"\ud83e\udd51"}),g=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).canvasRef=d.a.createRef(),a.state={width:48,height:28,seedlingNeeded:100,lockedAspect:!0},a}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.canvas=this.canvasRef.current,this.ctx=this.canvas.getContext("2d"),this.sourceImage=new Image,this.sourceImage.onload=function(){e.draw()},this.sourceImage.src="/bfg.png"}},{key:"draw",value:function(){var e=this.sourceImage,t=this.canvas,n=this.ctx,a=this.state.width,r=this.state.height;t.width=a,t.height=r,t.style.width=10*a+"px",t.style.height=10*r+"px",n.clearRect(0,0,a,r),n.imageSmoothingQuality="low",n.drawImage(e,0,0,a,r);var s=n.getImageData(0,0,a,r);this.imageData=s,this.setState({chipmunkNeeded:new Uint32Array(s.data.buffer).reduce((function(e,t){return e+(t?1:0)}),0)})}},{key:"onFilesChange",value:function(){var e=Object(i.a)(s.a.mark((function e(t){var n,a,r=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.sourceImage,(a=new FileReader).readAsDataURL(t[0]),n.onload=function(){var e=n.naturalWidth,t=n.naturalHeight;if(n.naturalWidth>50||n.naturalHeight>50){var a=e/t;e=Math.round(20*Math.min(1,a)),t=Math.round(20*Math.min(1,1/a))}r.setState({width:Math.min(50,Math.max(1,e)),height:Math.min(50,Math.max(1,t))}),r.draw()},a.onload=function(e){n.src=e.target.result};case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onFilesError",value:function(){var e=Object(i.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(t,n);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateVal",value:function(e,t){var n=this;if(t=Math.min(50,Math.max(1,t)),this.state.lockedAspect){var r,s,i=this.sourceImage.naturalWidth/this.sourceImage.naturalHeight;"width"===e?(r=t,s=Math.round(r/i)):(s=t,r=Math.round(s*i)),this.setState({width:Math.min(50,Math.max(1,r)),height:Math.min(50,Math.max(1,s))},(function(){n.draw()}))}else this.setState(Object(a.a)({},e,t),(function(){n.draw()}))}},{key:"changeLockedAspect",value:function(){this.setState({lockedAspect:!this.state.lockedAspect})}},{key:"render",value:function(){var e=this;return Object(b.jsx)("div",{className:"weapons-popup",children:Object(b.jsxs)("div",{className:"weapons-content",children:[Object(b.jsx)("h2",{children:"So you need a BFG?"}),Object(b.jsx)("div",{children:Object(b.jsx)(p.a,{type:"button",className:"btn",onChange:function(t){return e.onFilesChange(t)},onError:function(t,n){return e.onFilesError(t,n)},multiple:!1,accepts:["image/*"],minFileSize:1,clickable:!0,children:"Click to upload an image"})}),Object(b.jsxs)("div",{children:[Object(b.jsx)("label",{children:"Width"}),Object(b.jsx)("input",{type:"number",value:this.state.width,min:1,max:50,onChange:function(t){return e.updateVal("width",t.target.value)}})," ",Object(b.jsx)("button",{className:"btn btn-outline-secondary low-right-margin"+(this.state.lockedAspect?" btn-pressed":" btn-not-pressed"),onClick:function(){return e.changeLockedAspect()},children:Object(b.jsx)("span",{role:"img","aria-label":"link",className:"berry",children:"\ud83d\udd17"})}),Object(b.jsx)("label",{children:"Height"}),Object(b.jsx)("input",{type:"number",value:this.state.height,min:1,max:50,onChange:function(t){return e.updateVal("height",t.target.value)}})]}),Object(b.jsxs)("button",{className:"btn btn-success btn-large",disabled:!this.props.account||this.props.account.chipmunkBalance<this.state.chipmunkNeeded,onClick:function(){return e.props.renderIt(e.imageData,e.state.chipmunkNeeded)},children:["Render on the board using ",this.state.chipmunkNeeded," ",x]}),Object(b.jsx)("div",{className:"canvas-wrapper",children:Object(b.jsx)("canvas",{ref:this.canvasRef,width:480,height:280,className:"draw-preview"})})]})})}}]),n}(d.a.Component)},153:function(e,t,n){"use strict";n.r(t);n(0);var a=n(144),r=n.n(a),s=(n(158),n(145)),i=n(2);r.a.render(Object(i.jsx)(s.a,{}),document.getElementById("root"))},158:function(e,t,n){},162:function(e,t,n){},163:function(e,t,n){},164:function(e,t){},169:function(e,t){},190:function(e,t){},192:function(e,t){},334:function(e,t,n){}},[[153,1,2]]]);
//# sourceMappingURL=main.ad784a64.chunk.js.map