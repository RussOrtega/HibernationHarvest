(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{130:function(e,t,n){"use strict";(function(e){var a=n(3),r=n.n(a),s=n(4),c=n(50),i=n(51),o=n(54),l=n(53),u=(n(150),n(151),n(0)),h=n.n(u),d=n(12),f=n.n(d),m=n(31),p=n(82),g=n(135),v=n.n(g),b=n(136),w=n(20),x=n.n(w),_=new f.a("10000000000000000000000"),y={networkId:"testnet",nodeUrl:"https://rpc.testnet.near.org",contractName:"wartest8.testnet",walletUrl:"https://wallet.testnet.near.org"},k=h.a.createElement("span",{role:"img","aria-label":"avocado",className:"berry"},"\ud83e\udd51"),E=h.a.createElement("span",{role:"img","aria-label":"banana",className:"berry"},"\ud83c\udf4c"),C=h.a.createElement("span",{role:"img","aria-label":"cucumber",className:"berry"},"\ud83e\udd52"),I=h.a.createElement("span",{role:"img","aria-label":"pepper",className:"berry"},"\ud83c\udf36\ufe0f"),S="Avocado",N="Banana",P=function(e){return"#".concat(e.toString(16).padStart(6,"0"))},D=function(e,t){return"#".concat(e.toString(16).padStart(6,"0")).concat(Math.round(255*t).toString(16).padStart(2,"0"))},O=function(e,t,n,a,r){var s=255&r,c=r>>8&255,i=r>>16&255;return(Math.round(e*a+i*(1-a))<<16)+(Math.round(t*a+c*(1-a))<<8)+Math.round(n*a+s*(1-a))},F=function(e,t){return O(255&e,e>>8&255,e>>16&255,(e>>24&255)/255,t)},B=function(e){e=P(e).substr(1);var t=parseInt(e.substr(0,2),16)/255,n=parseInt(e.substr(2,2),16)/255,a=parseInt(e.substr(4,2),16)/255,r=Math.max(t,n,a),s=r-Math.min(t,n,a),c=s&&(r===t?(n-a)/s:r===n?2+(a-t)/s:4+(t-n)/s);return[60*(c<0?c+6:c),r&&s/r,r]},A=function(e,t){return"rgba(".concat(e>>16,", ").concat(e>>8&255,", ").concat(255&e,", ").concat(t,")")},M=function(e){for(var t=[],n=0;n<31;++n)t.push("hsl(".concat(e,", 100%, ").concat(100*n/30,"%)"));return t},T=function(t){var n=e.from(t,"base64");if(2404!==n.length)throw new Error("Unexpected encoded line length");for(var a=[],r=4;r<n.length;r+=8){var s=n.readUInt32LE(r),c=n.readUInt32LE(r+4);a.push({color:s,ownerIndex:c})}return a},j=function(e){Object(o.a)(n,e);var t=Object(l.a)(n);function n(e){var a;Object(c.a)(this,n),a=t.call(this,e);var r=["#000000","#666666","#aaaaaa","#FFFFFF","#F44E3B","#D33115","#9F0500","#FE9200","#E27300","#C45100","#FCDC00","#FCC400","#FB9E00","#DBDF00","#B0BC00","#808900","#A4DD00","#68BC00","#194D33","#68CCCA","#16A5A5","#0C797D","#73D8FF","#009CE0","#0062B1","#AEA1FF","#7B64FF","#653294","#FDA1FF","#FA28FF","#AB149E"].map((function(e){return e.toLowerCase()})),s=parseInt(r[0].substring(1),16),i=(new Date).getTime(),o=i-(i-new Date("2021-05-09"))%6048e5+5184e5;return a.state={connected:!1,signedIn:!1,accountId:null,pendingPixels:0,boardLoaded:!1,selectedCell:null,alpha:.25,currentColor:s,pickerColor:D(s,.25),colors:r,gammaColors:M(0),pickingColor:!1,owners:[],accounts:{},highlightedAccountIndex:-1,selectedOwnerIndex:!1,farmingBanana:!1,weaponsOn:!1,weaponsCodePosition:0,freeDrawingStart:new Date(o),freeDrawingEnd:new Date(o+864e5),watchMode:!1},a._buttonDown=!1,a._oldCounts={},a._numFailedTxs=0,a._balanceRefreshTimer=null,a.canvasRef=h.a.createRef(),a._context=!1,a._lines=!1,a._queue=[],a._pendingPixels=[],a._refreshBoardTimer=null,a._sendQueueTimer=null,a._stopRefreshTime=(new Date).getTime()+6e5,a._accounts={},a._initNear().then((function(){a.setState({connected:!0,signedIn:!!a._accountId,accountId:a._accountId,ircAccountId:a._accountId.replace(".","_"),freeDrawingStart:a._freeDrawingStart,freeDrawingEnd:a._freeDrawingEnd},(function(){window.location.hash.indexOf("watch")>=0&&setTimeout((function(){return a.enableWatchMode()}),500)}))})),a}return Object(i.a)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.canvasRef.current;this._context=t.getContext("2d");var n=function(){var t=Object(s.a)(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.state.watchMode){t.next=2;break}return t.abrupt("return");case 2:if(!e.state.rendering){t.next=7;break}return t.next=5,e.drawImg(e.state.selectedCell);case 5:t.next=14;break;case 7:if(!e.state.pickingColor){t.next=11;break}e.pickColor(e.state.selectedCell),t.next=14;break;case 11:return e.saveColor(),t.next=14,e.drawPixel(e.state.selectedCell);case 14:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),a=function(t){var a,c;if("touches"in t){if(t.touches.length>1)return!0;var i=t.target.getBoundingClientRect();a=t.targetTouches[0].clientX-i.left,c=t.targetTouches[0].clientY-i.top}else a=t.offsetX,c=t.offsetY;a=Math.trunc(a/t.target.clientWidth*300),c=Math.trunc(c/t.target.clientHeight*200);var o=null;return a>=0&&a<300&&c>=0&&c<200&&(o={x:a,y:c}),JSON.stringify(o)!==JSON.stringify(e.state.selectedCell)&&e.setState({selectedCell:o,selectedOwnerIndex:e._lines&&o&&e._lines[o.y]&&e._lines[o.y][o.x].ownerIndex},Object(s.a)(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.renderCanvas(),null===e.state.selectedCell||!e._buttonDown){t.next=4;break}return t.next=4,n();case 4:case"end":return t.stop()}}),t)})))),t.preventDefault(),!1};t.addEventListener("mousemove",a),t.addEventListener("touchmove",a);var c=function(){var t=Object(s.a)(r.a.mark((function t(a){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e._buttonDown=!0,null===e.state.selectedCell){t.next=4;break}return t.next=4,n();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();t.addEventListener("mousedown",c),t.addEventListener("touchstart",c);var i=function(){e.setState({selectedCell:null},(function(){return e.renderCanvas()}))},o=function(){var t=Object(s.a)(r.a.mark((function t(n){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e._buttonDown=!1,"touches"in n&&i();case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();t.addEventListener("mouseup",o),t.addEventListener("touchend",o),t.addEventListener("mouseleave",i),t.addEventListener("mouseenter",(function(t){e._buttonDown&&("touches"in t||1&t.buttons||(e._buttonDown=!1))})),document.addEventListener("keydown",(function(t){t.altKey&&e.enablePickColor()})),document.addEventListener("keyup",(function(t){e.state.weaponsCodePosition<"idkfa".length&&(t.key.toLowerCase()==="idkfa"[e.state.weaponsCodePosition]?e.setState({weaponsCodePosition:e.state.weaponsCodePosition+1,weaponsOn:e.state.weaponsCodePosition+1==="idkfa".length}):e.setState({weaponsCodePosition:0})),!t.altKey&&e.disablePickColor()}))}},{key:"enablePickColor",value:function(){var e=this;this.setState({pickingColor:!0},(function(){e.renderCanvas()}))}},{key:"disablePickColor",value:function(){var e=this;this.setState({pickingColor:!1},(function(){e.renderCanvas()}))}},{key:"pickColor",value:function(e){var t=this;if(this.state.signedIn&&this._lines&&this._lines[e.y]){var n=this._lines[e.y][e.x].color;this.setState({currentColor:n,alpha:1,pickerColor:D(n,1),gammaColors:M(B(n)[0]),pickingColor:!1},(function(){t.renderCanvas()}))}}},{key:"refreshAllowance",value:function(){var e=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return alert("You're out of access key allowance. Need sign in again to refresh it"),e.next=3,this.logOut();case 3:return e.next=5,this.requestSignIn();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_sendQueue",value:function(){var e=Object(s.a)(r.a.mark((function e(){var t,n=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._queue.slice(0,100),this._queue=this._queue.slice(100),this._pendingPixels=t,e.prev=3,e.next=6,this._contract.draw({pixels:t},new f.a("75000000000000"));case 6:this._numFailedTxs=0,e.next=19;break;case 9:if(e.prev=9,e.t0=e.catch(3),-1===e.t0.toString().indexOf("does not have enough balance")){e.next=16;break}return e.next=15,this.refreshAllowance();case 15:return e.abrupt("return");case 16:console.log("Failed to send a transaction",e.t0),this._numFailedTxs+=1,this._numFailedTxs<3?(this._queue=this._queue.concat(this._pendingPixels),this._pendingPixels=[]):(this._pendingPixels=[],this._queue=[]);case 19:return e.prev=19,e.next=22,Promise.all([this.refreshBoard(!0),this.refreshAccountStats()]);case 22:e.next=26;break;case 24:e.prev=24,e.t1=e.catch(19);case 26:this._pendingPixels.forEach((function(e){n._pending[e.y][e.x]===e.color&&(n._pending[e.y][e.x]=-1)})),this._pendingPixels=[];case 28:case"end":return e.stop()}}),e,this,[[3,9],[19,24]])})));return function(){return e.apply(this,arguments)}}()},{key:"_pingQueue",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var n=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._sendQueueTimer&&(clearTimeout(this._sendQueueTimer),this._sendQueueTimer=null),0!==this._pendingPixels.length||!(this._queue.length>=100||t)){e.next=4;break}return e.next=4,this._sendQueue();case 4:this._queue.length>0&&(this._sendQueueTimer=setTimeout(Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._pingQueue(!0);case 2:case"end":return e.stop()}}),e)}))),500));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"drawImg",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var n,a,s,c,i,o,l,u,h,d,f,m;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.signedIn&&this._lines&&this._lines[t.y]){e.next=2;break}return e.abrupt("return");case 2:if(n=this.state.account?this.state.account.avocadoBalance:0,this._isFreeDrawing()||!(n-this.state.pendingPixels<this.state.avocadoNeeded)){e.next=5;break}return e.abrupt("return");case 5:for(a=this.imageData,s=a.width,c=a.height,i=t.x-Math.trunc(s/2),o=t.y-Math.trunc(c/2),l=new Uint32Array(this.imageData.data.buffer),u=0;u<c;++u)for(h=0;h<s;++h)(d=l[u*s+h])&&o+u>=0&&o+u<200&&i+h>=0&&i+h<300&&(f=this._lines[o+u]?this._lines[o+u][i+h].color:0,(m=F(d,f))!==f&&this._queue.push({x:i+h,y:o+u,color:m}));return this.setState({rendering:!1}),this._stopRefreshTime=(new Date).getTime()+6e5,e.next=16,this._pingQueue(!1);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"drawPixel",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var n,a,s,c,i,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.signedIn&&this._lines&&this._lines[t.y]){e.next=2;break}return e.abrupt("return");case 2:if(n=this.state.account?this.state.account.avocadoBalance:0,this._isFreeDrawing()||!(n-this.state.pendingPixels<1)){e.next=5;break}return e.abrupt("return");case 5:if(a=this._lines[t.y]?this._lines[t.y][t.x].color:0,s=255&this.state.currentColor,c=this.state.currentColor>>8&255,i=this.state.currentColor>>16&255,o=O(i,c,s,this.state.alpha,a),this._pending[t.y][t.x]===o||this._lines[t.y][t.x].color===o){e.next=14;break}this._pending[t.y][t.x]=o,e.next=15;break;case 14:return e.abrupt("return");case 15:return this._queue.push({x:t.x,y:t.y,color:o}),this._stopRefreshTime=(new Date).getTime()+6e5,e.next=19,this._pingQueue(!1);case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"parseAccount",value:function(e,t){return(e=e?{accountId:e.account_id,accountIndex:e.account_index,avocadoBalance:parseFloat(e.avocado_balance)/this._pixelCost,bananaBalance:parseFloat(e.banana_balance)/this._pixelCost,numPixels:e.num_pixels,farmingPreference:e.farming_preference}:{accountId:t,accountIndex:-1,avocadoBalance:25,bananaBalance:0,numPixels:0,farmingPreference:S}).startTime=(new Date).getTime(),e.avocadoPixels=e.farmingPreference===S?e.numPixels+1:0,e.bananaPixels=e.farmingPreference===N?e.numPixels:0,e.avocadoRewardPerMs=e.avocadoPixels/864e5,e.bananaRewardPerMs=e.bananaPixels/864e5,e}},{key:"getAccount",value:function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this._contract.get_account({account_id:t});case 3:return e.t1=e.sent,e.t2=t,e.abrupt("return",e.t0.parseAccount.call(e.t0,e.t1,e.t2));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAccountByIndex",value:function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,this._contract.get_account_by_index({account_index:t});case 3:return e.t1=e.sent,e.abrupt("return",e.t0.parseAccount.call(e.t0,e.t1,"unknown"));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"refreshAccountStats",value:function(){var e=Object(s.a)(r.a.mark((function e(){var t,n=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAccount(this._accountId);case 2:t=e.sent,this._balanceRefreshTimer&&(clearInterval(this._balanceRefreshTimer),this._balanceRefreshTimer=null),this.setState({pendingPixels:this._pendingPixels.length+this._queue.length,farmingBanana:t.farmingPreference===N,account:t}),this._balanceRefreshTimer=setInterval((function(){var e=(new Date).getTime()-t.startTime;n.setState({account:Object.assign({},t,{avocadoBalance:t.avocadoBalance+e*t.avocadoRewardPerMs,bananaBalance:t.bananaBalance+e*t.bananaRewardPerMs}),pendingPixels:n._pendingPixels.length+n._queue.length})}),100);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_initNear",value:function(){var e=Object(s.a)(r.a.mark((function e(){var t,n,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new m.keyStores.BrowserLocalStorageKeyStore,e.next=3,m.connect(Object.assign({deps:{keyStore:t}},y));case 3:return n=e.sent,this._keyStore=t,this._near=n,this._walletConnection=new m.WalletConnection(n,y.contractName),this._accountId=this._walletConnection.getAccountId(),this._account=this._walletConnection.account(),this._contract=new m.Contract(this._account,y.contractName,{viewMethods:["get_account","get_account_by_index","get_lines","get_line_versions","get_pixel_cost","get_account_balance","get_account_num_pixels","get_account_id_by_index","get_free_drawing_timestamp"],changeMethods:["draw","buy_tokens","select_farming_preference"]}),e.t0=parseFloat,e.next=13,this._contract.get_pixel_cost();case 13:return e.t1=e.sent,this._pixelCost=(0,e.t0)(e.t1),e.next=17,this._contract.get_free_drawing_timestamp();case 17:if(a=e.sent,this._freeDrawingStart=new Date(a),this._freeDrawingEnd=new Date(a+864e5),!this._accountId){e.next=23;break}return e.next=23,this.refreshAccountStats();case 23:return this._lineVersions=Array(200).fill(-1),this._lines=Array(200).fill(!1),this._pending=Array(200).fill(!1),this._pending.forEach((function(e,t,n){return n[t]=Array(300).fill(-1)})),e.next=29,this.refreshBoard(!0);case 29:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshBoard",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var n,a,c,i,o,l,u,h,d,f,m=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._refreshBoardTimer&&(clearTimeout(this._refreshBoardTimer),this._refreshBoardTimer=null),n=(new Date).getTime(),(this.state.watchMode||n<this._stopRefreshTime)&&(this._refreshBoardTimer=setTimeout(Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.refreshBoard(!1);case 2:case"end":return e.stop()}}),e)}))),1e3)),t||!document.hidden){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,this._contract.get_line_versions();case 7:for(a=e.sent,c=[],i=0;i<200;++i)a[i]!==this._lineVersions[i]&&c.push(i);for(o=[],l=0;l<c.length;l+=50)o.push(c.slice(l,l+50));return e.next=14,Promise.all(o.map((function(e){return m._contract.get_lines({lines:e})})));case 14:for(u=(u=e.sent).flat(),o=o.flat(),h=0;h<o.length;++h)d=o[h],f=T(u[h]),this._lines[d]=f;this._lineVersions=a,this.state.watchMode||this._refreshOwners(),this.renderCanvas();case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_refreshOwners",value:function(){var e=this,t={};this._lines.flat().forEach((function(e){t[e.ownerIndex]=(t[e.ownerIndex]||0)+1})),delete t[0];var n=Object.keys(t).sort((function(e,n){return t[n]-t[e]}));this.setState({owners:n.map((function(e){return{accountIndex:e=parseInt(e),numPixels:t[e]}}))}),n.forEach(function(){var n=Object(s.a)(r.a.mark((function n(a){return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((a=parseInt(a))in e._accounts&&t[a]===(e._oldCounts[a]||0)){n.next=12;break}return n.prev=2,n.next=5,e.getAccountByIndex(a);case 5:e._accounts[a]=n.sent,n.next=11;break;case 8:n.prev=8,n.t0=n.catch(2),console.log("Failed to fetch account index #",a,n.t0);case 11:e.setState({accounts:Object.assign({},e._accounts)});case 12:case"end":return n.stop()}}),n,null,[[2,8]])})));return function(e){return n.apply(this,arguments)}}()),this.setState({accounts:Object.assign({},this._accounts)}),this._oldCounts=t}},{key:"renderCanvas",value:function(){if(this._context&&this._lines){for(var e=this._context,t=0;t<200;++t){var n=this._lines[t];if(n)for(var a=0;a<300;++a){var r=n[a];e.fillStyle=P(r.color),e.fillRect(12*a,12*t,12,12),this.state.highlightedAccountIndex>=0&&(r.ownerIndex!==this.state.highlightedAccountIndex?(e.fillStyle="rgba(32, 32, 32, 0.8)",e.fillRect(12*a,12*t,6,6),e.fillRect(12*(a+.5),12*(t+.5),6,6),e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(12*a,12*(t+.5),6,6),e.fillRect(12*(a+.5),12*t,6,6)):(e.beginPath(),e.strokeStyle=e.fillStyle="rgba(255, 255, 255, 0.8)",e.lineWidth=.5,e.rect(12*a+.5,12*t+.5,11,11),e.stroke(),e.closePath()))}}if(this._pendingPixels.concat(this._queue).forEach((function(t){e.fillStyle=P(t.color),e.fillRect(12*t.x,12*t.y,12,12)})),this.state.selectedCell&&!this.state.watchMode){var s=this.state.selectedCell;if(this.state.rendering)for(var c=this.imageData,i=c.width,o=c.height,l=s.x-Math.trunc(i/2),u=s.y-Math.trunc(o/2),h=new Uint32Array(this.imageData.data.buffer),d=0;d<o;++d)for(var f=0;f<i;++f){var m=h[d*i+f];if(m&&u+d>=0&&u+d<200&&l+f>=0&&l+f<300){var p=this._lines[u+d]?this._lines[u+d][l+f].color:0;e.fillStyle=P(F(m,p)),e.fillRect(12*(l+f),12*(u+d),12,12)}}else if(this.state.pickingColor){var g=this._lines[s.y]?this._lines[s.y][s.x].color:0;e.beginPath(),e.strokeStyle=e.fillStyle=A(g,.5),e.lineWidth=48,e.arc(12*(s.x+.5),12*(s.y+.5),48,0,2*Math.PI),e.stroke(),e.closePath(),e.beginPath(),e.strokeStyle=e.fillStyle=A(g,1),e.lineWidth=24,e.arc(12*(s.x+.5),12*(s.y+.5),48,0,2*Math.PI),e.stroke(),e.closePath()}else e.fillStyle=A(this.state.currentColor,.2),e.fillRect(12*s.x,0,12,12*s.y),e.fillRect(12*s.x,12*(s.y+1),12,12*(200-s.y-1)),e.fillRect(0,12*s.y,12*s.x,12),e.fillRect(12*(s.x+1),12*s.y,12*(300-s.x-1),12),e.beginPath(),e.lineWidth=3,e.fillStyle=P(this.state.currentColor),e.strokeStyle=P(this.state.currentColor),e.rect(12*s.x,12*s.y,12,12),e.stroke(),e.closePath()}this.state.boardLoaded||this.setState({boardLoaded:!0})}}},{key:"requestSignIn",value:function(){var e=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"Berry Club",e.next=3,this._walletConnection.requestSignIn(y.contractName,"Berry Club");case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"logOut",value:function(){var e=Object(s.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._walletConnection.signOut(),this._accountId=null,this.setState({signedIn:!!this._accountId,accountId:this._accountId});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"alphaColorChange",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var n=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({alpha:t.rgb.a},(function(){n.changeColor(t,t.rgb.a)}));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hueColorChange",value:function(e){this.setState({gammaColors:M(e.hsl.h)}),this.changeColor(e)}},{key:"saveColor",value:function(){var e=P(this.state.currentColor),t=this.state.colors.indexOf(e);t>=0&&this.state.colors.splice(t,1),this.setState({colors:[e].concat(this.state.colors).slice(0,31)})}},{key:"changeColor",value:function(e,t){var n=this;t=t||1;var a=65536*e.rgb.r+256*e.rgb.g+e.rgb.b;e.hex=D(a,t),e.rgb.a=t,e.hsl.a=t,e.hsv.a=t,this.setState({pickerColor:e,alpha:t,currentColor:a},(function(){n.renderCanvas()}))}},{key:"buyTokens",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=_.muln(t),e.next=3,this._contract.buy_tokens({},new f.a("30000000000000"),n);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setHover",value:function(e,t){var n=this;t?this.setState({highlightedAccountIndex:e},(function(){n.renderCanvas()})):this.state.highlightedAccountIndex===e&&this.setState({highlightedAccountIndex:-1},(function(){n.renderCanvas()}))}},{key:"switchBerry",value:function(){var e=Object(s.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({farmingBanana:t}),e.next=3,this._contract.select_farming_preference({berry:t?N:S});case 3:return e.next=5,this.refreshAccountStats();case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"renderImg",value:function(){var e=Object(s.a)(r.a.mark((function e(t,n){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.imageData=t,this.setState({weaponsOn:!1,weaponsCodePosition:0,rendering:!0,pickingColor:!1,avocadoNeeded:n});case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_isFreeDrawing",value:function(){var e=new Date;return this.state.freeDrawingStart<=e&&e<this.state.freeDrawingEnd}},{key:"enableWatchMode",value:function(){this.setState({watchMode:!0,weaponsOn:!1,weaponsCodePosition:0}),document.body.style.transition="3s",document.body.style.backgroundColor="#333"}},{key:"render",value:function(){var e=this,t=this.state.watchMode?" hidden":"",n=this._isFreeDrawing(),a=h.a.createElement("div",{className:"free-drawing ".concat(n?"free":"wait").concat(t)},n?"BANANZA!!! Draw for free ":"Time until free drawing ",h.a.createElement(x.a,{initialTime:n?this.state.freeDrawingEnd-new Date:this.state.freeDrawingStart-new Date,direction:"backward",timeToUpdate:100,lastUnit:"d",checkpoints:[{time:0}]},(function(){return h.a.createElement(h.a.Fragment,null,h.a.createElement(x.a.Days,{formatValue:function(e){return e>1?"".concat(e," days "):e?"1 day ":""}}),h.a.createElement(x.a.Hours,null),":",h.a.createElement(x.a.Minutes,{formatValue:function(e){return"".concat(e).padStart(2,"0")}}),":",h.a.createElement(x.a.Seconds,{formatValue:function(e){return"".concat(e).padStart(2,"0")}}),".",h.a.createElement(x.a.Milliseconds,{formatValue:function(e){return"".concat(e).padStart(3,"0")}}))}))),r=this.state.connected?this.state.signedIn?h.a.createElement("div",null,h.a.createElement("div",{className:"float-right".concat(t)},h.a.createElement("button",{className:"btn btn-outline-secondary",onClick:function(){return e.logOut()}},"Log out (",this.state.accountId,")")),a,h.a.createElement("div",{className:"your-balance".concat(t)},"Balance:"," ",h.a.createElement(R,{account:this.state.account,pendingPixels:this.state.pendingPixels,isFreeDrawing:n,detailed:!0}),h.a.createElement("div",null,"Farming preference:",h.a.createElement(v.a,{onChange:function(t){return e.switchBerry(t)},checked:this.state.farmingBanana,className:"react-switch",height:30,width:70,offColor:"#666",onColor:"#666",uncheckedIcon:h.a.createElement("div",{className:"switch-berry avocado"},k),checkedIcon:h.a.createElement("div",{className:"switch-berry banana"},E)}))),h.a.createElement("div",{className:"buttons".concat(t)},h.a.createElement("button",{className:"btn btn-primary",onClick:function(){return e.buyTokens(10)}},"Buy ",h.a.createElement("span",{className:"font-weight-bold"},"25",k)," for"," ",h.a.createElement("span",{className:"font-weight-bold"},"\u24c30.1"))," ",h.a.createElement("button",{className:"btn btn-primary",onClick:function(){return e.buyTokens(40)}},"Buy ",h.a.createElement("span",{className:"font-weight-bold"},"100",k)," for"," ",h.a.createElement("span",{className:"font-weight-bold"},"\u24c30.4"))," ",h.a.createElement("button",{className:"btn btn-primary",onClick:function(){return e.buyTokens(100)}},"Buy ",h.a.createElement("span",{className:"font-weight-bold"},"250",k)," for"," ",h.a.createElement("span",{className:"font-weight-bold"},"\u24c31"))," ",h.a.createElement("button",{className:"btn btn-success",onClick:function(){return e.buyTokens(500)}},"DEAL: Buy ",h.a.createElement("span",{className:"font-weight-bold"},"1500",k)," ","for ",h.a.createElement("span",{className:"font-weight-bold"},"\u24c35"))),h.a.createElement("div",{className:"color-picker".concat(t)},h.a.createElement(p.a,{className:"circle-picker",colors:this.state.gammaColors,color:this.state.pickerColor,triangle:"hide",width:"100%",onChangeComplete:function(t){return e.changeColor(t)}}),h.a.createElement(p.a,{className:"circle-picker",colors:this.state.colors,color:this.state.pickerColor,triangle:"hide",width:"100%",onChangeComplete:function(t){return e.hueColorChange(t)}}))):h.a.createElement("div",{style:{marginBottom:"10px"}},a,h.a.createElement("div",null,h.a.createElement("button",{className:"btn btn-primary",onClick:function(){return e.requestSignIn()}},"Log in with NEAR Wallet"))):h.a.createElement("div",null,"Connecting..."," ",h.a.createElement("span",{className:"spinner-grow spinner-grow-sm",role:"status","aria-hidden":"true"})),s=this.state.weaponsOn?h.a.createElement("div",null,h.a.createElement(b.a,{account:this.state.account,isFreeDrawing:n,renderIt:function(t,n){return e.renderImg(t,n)},enableWatchMode:function(){return e.enableWatchMode()}})):"";return h.a.createElement("div",null,h.a.createElement("div",{className:"header".concat(t)},h.a.createElement("h2",null,"PIXEL WARS")," ",h.a.createElement("a",{className:"btn btn-outline-none",href:"https://farm.berryclub.io"},"Berry Farm ",C),h.a.createElement("a",{className:"btn btn-outline-none",href:"https://app.ref.finance/#wrap.near|berryclub.ek.near"},"REF Finance ",E),h.a.createElement("a",{className:"btn btn-outline-none",href:"https://berry.cards"},"[BETA] Berry Cards ",I),r),h.a.createElement("div",{className:"container"},h.a.createElement("div",{className:"row"},h.a.createElement("div",null,h.a.createElement("div",null,h.a.createElement("canvas",{ref:this.canvasRef,width:3600,height:2400,className:this.state.boardLoaded?"pixel-board".concat(this.state.watchMode?" watch-mode":""):"pixel-board c-animated-background"}))),h.a.createElement("div",{className:"leaderboard".concat(t)},h.a.createElement("div",null,h.a.createElement(L,{owners:this.state.owners,accounts:this.state.accounts,setHover:function(t,n){return e.setHover(t,n)},selectedOwnerIndex:this.state.selectedOwnerIndex,highlightedAccountIndex:this.state.highlightedAccountIndex}))))),h.a.createElement("div",{className:"padded".concat(t)},this.state.signedIn?h.a.createElement("div",null,h.a.createElement("iframe",{title:"irc",className:"irc",frameBorder:"0",src:"https://kiwiirc.com/client/irc.kiwiirc.com/?nick=".concat(this.state.ircAccountId,"#berryclub")})):""),s,h.a.createElement("a",{className:"github-fork-ribbon right-bottom fixed".concat(t),href:"https://github.com/evgenykuzyakov/berryclub","data-ribbon":"Fork me on GitHub",title:"Fork me on GitHub"},"Fork me on GitHub"))}}]),n}(h.a.Component),R=function(e){var t=e.account;if(!t)return"";var n=e.detailed?3:1,a=t.avocadoBalance-(e.isFreeDrawing?0:e.pendingPixels||0),r=t.avocadoPixels>0?h.a.createElement("span",null,"(+",h.a.createElement("span",{className:"font-weight-bold"},t.avocadoPixels),k,"/day)"):"",s=t.bananaPixels>0?h.a.createElement("span",null,"(+",h.a.createElement("span",{className:"font-weight-bold"},t.bananaPixels),E,"/day)"):"";return h.a.createElement("span",{className:"balances font-small"},h.a.createElement("span",{className:"font-weight-bold"},a.toFixed(n)),k," ",h.a.createElement("span",{className:"font-weight-bold"},t.bananaBalance.toFixed(n)),E," ",r,s,e.pendingPixels?h.a.createElement("span",null," (",e.pendingPixels," pending)"):"")},L=function(e){var t=e.owners.map((function(t){return t.accountIndex in e.accounts&&(t.account=e.accounts[t.accountIndex]),h.a.createElement(q,Object.assign({key:t.accountIndex},t,{isSelected:t.accountIndex===e.selectedOwnerIndex,setHover:function(n){return e.setHover(t.accountIndex,n)},isHighlighted:t.accountIndex===e.highlightedAccountIndex}))}));return h.a.createElement("table",{className:"table table-hover table-sm"},h.a.createElement("tbody",null,t))},q=function(e){var t=e.account;return h.a.createElement("tr",{onMouseEnter:function(){return e.setHover(!0)},onMouseLeave:function(){return e.setHover(!1)},className:e.isSelected?"selected":""},h.a.createElement("td",null,t?h.a.createElement(H,{accountId:t.accountId}):"..."),h.a.createElement("td",{className:"text-nowrap"},h.a.createElement("small",null,h.a.createElement(R,{account:t}))))},H=function(e){var t=e.accountId,n=t.length>15?t.slice(0,6)+"..."+t.slice(-6):t;return h.a.createElement("a",{className:"account",href:"https://wayback.berryclub.io/".concat(t)},n)};t.a=j}).call(this,n(14).Buffer)},136:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var a=n(137),r=n(3),s=n.n(r),c=n(4),i=n(50),o=n(51),l=n(54),u=n(53),h=(n(316),n(0)),d=n.n(h),f=n(138),m=n.n(f),p=d.a.createElement("span",{role:"img","aria-label":"avocado",className:"berry"},"\ud83e\udd51"),g=function(e){Object(l.a)(n,e);var t=Object(u.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).canvasRef=d.a.createRef(),a.state={width:300,height:200,avocadoNeeded:100,lockedAspect:!0},a}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.canvas=this.canvasRef.current,this.ctx=this.canvas.getContext("2d"),this.sourceImage=new Image,this.sourceImage.onload=function(){e.draw()},this.sourceImage.src="/bfg.png"}},{key:"draw",value:function(){var e=this.sourceImage,t=this.canvas,n=this.ctx,a=this.state.width,r=this.state.height;t.width=a,t.height=r,t.style.width=10*a+"px",t.style.height=10*r+"px",n.clearRect(0,0,a,r),n.imageSmoothingQuality="low",n.drawImage(e,0,0,a,r);var s=n.getImageData(0,0,a,r);this.imageData=s,this.setState({avocadoNeeded:new Uint32Array(s.data.buffer).reduce((function(e,t){return e+(t?1:0)}),0)})}},{key:"onFilesChange",value:function(){var e=Object(c.a)(s.a.mark((function e(t){var n,a,r=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.sourceImage,(a=new FileReader).readAsDataURL(t[0]),n.onload=function(){var e=n.naturalWidth,t=n.naturalHeight;if(n.naturalWidth>300||n.naturalHeight>200){var a=e/t;e=Math.round(20*Math.min(1,a)),t=Math.round(20*Math.min(1,1/a))}r.setState({width:Math.min(300,Math.max(1,e)),height:Math.min(200,Math.max(1,t))}),r.draw()},a.onload=function(e){n.src=e.target.result};case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onFilesError",value:function(){var e=Object(c.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(t,n);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"updateVal",value:function(e,t){var n=this;if(t=Math.min(300,Math.max(1,t)),this.state.lockedAspect){var r,s,c=this.sourceImage.naturalWidth/this.sourceImage.naturalHeight;"width"===e?(r=t,s=Math.round(r/c)):(s=t,r=Math.round(s*c)),this.setState({width:Math.min(300,Math.max(1,r)),height:Math.min(200,Math.max(1,s))},(function(){n.draw()}))}else this.setState(Object(a.a)({},e,t),(function(){n.draw()}))}},{key:"changeLockedAspect",value:function(){this.setState({lockedAspect:!this.state.lockedAspect})}},{key:"render",value:function(){var e=this;return d.a.createElement("div",{className:"weapons-popup"},d.a.createElement("div",{className:"weapons-content"},d.a.createElement("h2",null,"So you need a BFG?"),d.a.createElement("div",null,d.a.createElement(m.a,{type:"button",className:"btn",onChange:function(t){return e.onFilesChange(t)},onError:function(t,n){return e.onFilesError(t,n)},multiple:!1,accepts:["image/*"],minFileSize:1,clickable:!0},"Click to upload an image")),d.a.createElement("div",null,d.a.createElement("label",null,"Width"),d.a.createElement("input",{type:"number",value:this.state.width,min:1,max:300,onChange:function(t){return e.updateVal("width",t.target.value)}})," ",d.a.createElement("button",{className:"btn btn-outline-secondary low-right-margin"+(this.state.lockedAspect?" btn-pressed":" btn-not-pressed"),onClick:function(){return e.changeLockedAspect()}},d.a.createElement("span",{role:"img","aria-label":"link",className:"berry"},"\ud83d\udd17")),d.a.createElement("label",null,"Height"),d.a.createElement("input",{type:"number",value:this.state.height,min:1,max:200,onChange:function(t){return e.updateVal("height",t.target.value)}})),d.a.createElement("button",{className:"btn btn-success btn-large",disabled:!this.props.account||!this.props.isFreeDrawing&&this.props.account.avocadoBalance<this.state.avocadoNeeded,onClick:function(){return e.props.renderIt(e.imageData,e.state.avocadoNeeded)}},"Render on the board using ",this.state.avocadoNeeded," ",p),d.a.createElement("button",{className:"btn btn-primary btn-large",onClick:function(){return e.props.enableWatchMode()}},"Enable watch mode"),d.a.createElement("div",{className:"canvas-wrapper"},d.a.createElement("canvas",{ref:this.canvasRef,width:480,height:280,className:"draw-preview"}))))}}]),n}(d.a.Component)},139:function(e,t,n){e.exports=n(140)},140:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(129),c=n.n(s),i=(n(145),n(130));c.a.render(r.a.createElement(i.a,null),document.getElementById("root"))},145:function(e,t,n){},150:function(e,t,n){},151:function(e,t,n){},152:function(e,t){},158:function(e,t){},316:function(e,t,n){}},[[139,1,2]]]);
//# sourceMappingURL=main.98faee6c.chunk.js.map